<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TruckInvoice - Quick Invoice Generator for OTR Drivers</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
</head>

<body>
    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <h2>Sign In to Sync</h2>
            <p class="auth-subtitle">Sync your data across all your devices</p>

            <div id="authTabs" class="auth-tabs">
                <button type="button" class="auth-tab active" data-auth="signin">Sign In</button>
                <button type="button" class="auth-tab" data-auth="signup">Sign Up</button>
                <button type="button" class="auth-tab" data-auth="anonymous">Continue Without Account</button>
            </div>

            <!-- Sign In Form -->
            <div id="signinForm" class="auth-form active">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="signinEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="signinPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="button" id="signinBtn" class="btn-auth">Sign In</button>
            </div>

            <!-- Sign Up Form -->
            <div id="signupForm" class="auth-form">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="signupEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div class="form-group">
                    <label>Confirm Password:</label>
                    <input type="password" id="signupPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="button" id="signupBtn" class="btn-auth">Sign Up</button>
            </div>

            <!-- Anonymous Form -->
            <div id="anonymousForm" class="auth-form">
                <p class="anonymous-info">Continue without creating an account. Your data will sync across devices on
                    this browser, but you won't be able to access it from other browsers unless you sign up later.</p>
                <button type="button" id="anonymousBtn" class="btn-auth">Continue Anonymously</button>
            </div>

            <div id="authError" class="auth-error hidden"></div>
        </div>
    </div>

    <div class="container">
        <!-- Sync Status Bar -->
        <div id="syncStatus" class="sync-status">
            <span id="syncStatusIcon" class="sync-icon">üîÑ</span>
            <span id="syncStatusText">Connecting...</span>
            <button type="button" id="forceSyncBtn" class="btn-force-sync" onclick="forceDataSync()">üîÑ Force
                Sync</button>
            <button type="button" id="signoutBtn" class="btn-signout hidden">Sign Out</button>
        </div>

        <h1>TruckInvoice Generator</h1>
        <p class="subtitle">Generate professional invoices in seconds</p>

        <!-- Mobile Navigation Dropdown -->
        <div class="nav-dropdown-container">
            <select id="navDropdown" class="nav-dropdown" title="Navigate to page"
                onchange="window.navigateTo(this.value)">
                <option value="invoice">New Invoice</option>
                <option value="receipt">Upload Receipt</option>
                <option value="history">Invoice History</option>
                <option value="expenses">Expenses</option>
                <option value="tools">Driver Tools</option>
                <option value="dashboard">Dashboard</option>
            </select>
        </div>

        <!-- Desktop Navigation Tabs -->
        <div class="nav-tabs">
            <button type="button" id="newInvoiceBtn" class="nav-tab active" onclick="window.navigateTo('invoice')">New
                Invoice</button>
            <button type="button" id="receiptUploadBtn" class="nav-tab" onclick="window.navigateTo('receipt')">Upload
                Receipt</button>
            <button type="button" id="historyBtn" class="nav-tab" onclick="window.navigateTo('history')">Invoice
                History</button>
            <button type="button" id="expensesBtn" class="nav-tab"
                onclick="window.navigateTo('expenses')">Expenses</button>
            <button type="button" id="toolsBtn" class="nav-tab" onclick="window.navigateTo('tools')">Tools</button>
            <button type="button" id="dashboardBtn" class="nav-tab"
                onclick="window.navigateTo('dashboard')">Dashboard</button>
        </div>

        <!-- New Invoice View -->
        <div id="invoiceFormView" class="view active">
            <form id="invoiceForm">
                <!-- Your Company Info (saved automatically) -->
                <div class="section">
                    <h2>Your Company Info (Auto-saved)</h2>
                    <div class="form-group">
                        <label>Your Company Name:</label>
                        <input type="text" id="companyName" placeholder="ABC Transportation LLC" required>
                    </div>
                    <div class="form-group">
                        <label>Your Address:</label>
                        <input type="text" id="companyAddress" placeholder="123 Main St, Your City, ST 12345" required>
                    </div>
                    <div class="form-group">
                        <label>Carrier ID:</label>
                        <input type="text" id="carrierId" placeholder="000000" required>
                    </div>
                    <div class="form-group">
                        <label>Your Email (for notifications):</label>
                        <input type="email" id="userEmail" placeholder="driver@example.com" required>
                    </div>
                </div>

                <!-- Load Details (changes each time) -->
                <div class="section">
                    <h2>Load Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Invoice #:</label>
                            <input type="text" id="invoiceNumber" placeholder="001" required>
                        </div>
                        <div class="form-group">
                            <label>Invoice Date:</label>
                            <input type="date" id="invoiceDate" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Customer's Name:</label>
                        <div class="customer-input-wrapper">
                            <input type="text" id="customerName" placeholder="ABC Company LLC" required>
                            <select id="customerQuickFill" class="quick-fill-select"
                                title="Select a repeat customer to auto-fill details">
                                <option value="">Quick Fill...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Truck:</label>
                            <select id="invoiceTruck" title="Select truck">
                                <option value="">Select Truck...</option>
                            </select>
                        </div>
                        <div class="form-group truck-manage-btn-container">
                            <button type="button" class="btn-secondary btn-small manage-trucks-global"
                                onclick="openTruckModal()">‚öôÔ∏è Manage Trucks</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date Delivered:</label>
                            <input type="date" id="dateDelivered" required>
                        </div>
                        <div class="form-group">
                            <label>Load Number:</label>
                            <input type="text" id="loadNumber" placeholder="LOAD123" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Amount to be Paid ($):</label>
                        <input type="number" step="0.01" id="amount" placeholder="1000.00" required>
                    </div>

                    <!-- Accessories/Additional Charges -->
                    <div class="form-group">
                        <label>Additional Charges (Optional):</label>
                        <div id="accessoriesContainer">
                            <!-- Accessories will be added here dynamically -->
                        </div>
                        <button type="button" class="btn-add-accessory" id="addAccessoryBtn1">+ Add Charge (Detention,
                            Lumper, etc.)</button>
                    </div>
                </div>

                <!-- Calculator Tabs -->
                <div class="section calculator-section">
                    <h2>Payment Calculator (Optional)</h2>

                    <!-- Calculator Type Selector -->
                    <div class="calculator-tabs">
                        <button type="button" class="calc-tab active" data-calc="miles">Miles/Rate</button>
                        <button type="button" class="calc-tab" data-calc="product">Product Count</button>
                    </div>

                    <!-- Mile/Rate Calculator -->
                    <div id="milesCalculator" class="calculator-panel active">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Miles Driven:</label>
                                <input type="number" step="0.1" id="miles" placeholder="450">
                            </div>
                            <div class="form-group">
                                <label>Rate per Mile ($):</label>
                                <input type="number" step="0.01" id="ratePerMile" placeholder="2.50">
                            </div>
                        </div>
                        <div class="calculator-result">
                            <div class="calculated-amount" id="calculatedAmount">
                                <span class="calc-label">Calculated Amount:</span>
                                <span class="calc-value">$0.00</span>
                            </div>
                            <button type="button" class="btn-use-calculated" id="useCalculated" disabled>Use This
                                Amount</button>
                        </div>
                    </div>

                    <!-- Product Count Calculator -->
                    <div id="productCalculator" class="calculator-panel">
                        <div class="form-group">
                            <label>Product Description:</label>
                            <input type="text" id="productDescription"
                                placeholder="e.g., Pallets of Lumber, Boxes of Electronics">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Piece Count:</label>
                                <input type="number" step="1" id="pieceCount" placeholder="100">
                            </div>
                            <div class="form-group">
                                <label>Rate per Piece ($):</label>
                                <input type="number" step="0.01" id="ratePerPiece" placeholder="5.00">
                            </div>
                        </div>
                        <div class="calculator-result">
                            <div class="calculated-amount" id="calculatedProductAmount">
                                <span class="calc-label">Calculated Amount:</span>
                                <span class="calc-value">$0.00</span>
                            </div>
                            <button type="button" class="btn-use-calculated" id="useCalculatedProduct" disabled>Use This
                                Amount</button>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-generate">Generate Invoice PDF</button>
            </form>
        </div>

        <!-- Receipt Upload View -->
        <div id="receiptUploadView" class="view">
            <form id="receiptForm" class="receipt-form">
                <div class="section">
                    <h2>üì∏ Snap & Save Receipt</h2>
                    <p class="section-description">Take a photo of your receipt and enter the details. Photos are stored
                        on your device for tax records.</p>

                    <div class="form-group">
                        <label>Receipt Photo:</label>
                        <div class="receipt-upload-wrapper">
                            <input type="file" id="receiptImage" accept="image/*" capture="environment">
                            <div class="file-input-label">üì∑ Take Photo or Choose Image</div>
                        </div>
                    </div>

                    <div id="receiptPreview" class="receipt-preview hidden">
                        <img id="previewImage" alt="Receipt Preview">
                    </div>

                    <div class="receipt-entry-form">
                        <h3>Receipt Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Truck:</label>
                                <select id="receiptTruck" title="Select truck">
                                    <option value="">All Trucks / No Selection</option>
                                </select>
                            </div>
                            <div class="form-group truck-manage-btn-container">
                                <button type="button" id="manageTrucksBtn" class="btn-secondary btn-small"
                                    onclick="openTruckModal()">‚öôÔ∏è Manage
                                    Trucks</button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date:</label>
                                <input type="date" id="receiptDate" required>
                            </div>
                            <div class="form-group">
                                <label>Amount ($):</label>
                                <input type="number" step="0.01" id="receiptAmount" placeholder="50.00" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Category:</label>
                                <select id="receiptCategory" title="Select expense category" required>
                                    <option value="">Select Category...</option>
                                    <option value="fuel">Fuel</option>
                                    <option value="maintenance">Maintenance & Repairs</option>
                                    <option value="tolls">Tolls & Parking</option>
                                    <option value="food">Food & Meals</option>
                                    <option value="insurance">Insurance</option>
                                    <option value="permits">Permits & Licenses</option>
                                    <option value="truck_payment">Truck Payment/Lease</option>
                                    <option value="supplies">Supplies</option>
                                    <option value="drivers_pay">Drivers Pay</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Vendor/Store:</label>
                                <input type="text" id="receiptVendor" placeholder="Pilot, Love's, etc." required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notes (Optional):</label>
                            <input type="text" id="receiptNotes" placeholder="Additional details...">
                        </div>
                        <button type="submit" class="btn-generate">üíæ Save Receipt & Expense</button>
                    </div>
                </div>
            </form>

            <div class="saved-receipts-section">
                <div class="receipts-header">
                    <h3>üìÅ Saved Receipts</h3>
                    <div class="receipts-filter">
                        <select id="filterReceiptTruck" title="Filter by truck">
                            <option value="">All Trucks</option>
                        </select>
                    </div>
                </div>
                <p class="section-description">Your receipt photos are stored locally on this device.</p>
                <div id="savedReceiptsList" class="saved-receipts-list">
                    <div class="no-history">No saved receipts yet.</div>
                </div>
            </div>
        </div>

        <!-- Invoice History View -->
        <div id="historyView" class="view">
            <div class="history-header-section">
                <input type="text" id="searchHistory" placeholder="Search by invoice #, load #, or customer name..."
                    class="search-input">
            </div>
            <div id="historyList" class="history-list">
                <div class="no-history">No invoices yet. Generate your first invoice!</div>
            </div>
        </div>

        <!-- Expenses View -->
        <div id="expensesView" class="view">
            <form id="expenseForm" class="expense-form">
                <div class="section">
                    <h2>Add Expense</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Truck:</label>
                            <select id="expenseTruck" title="Select truck">
                                <option value="">All Trucks / No Selection</option>
                            </select>
                        </div>
                        <div class="form-group truck-manage-btn-container">
                            <button type="button" class="btn-secondary btn-small manage-trucks-global"
                                onclick="openTruckModal()">‚öôÔ∏è Manage</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label>Amount ($):</label>
                            <input type="number" step="0.01" id="expenseAmount" placeholder="50.00" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Category:</label>
                            <select id="expenseCategory" title="Select expense category" required>
                                <option value="">Select Category...</option>
                                <option value="fuel">Fuel</option>
                                <option value="maintenance">Maintenance & Repairs</option>
                                <option value="tolls">Tolls & Parking</option>
                                <option value="food">Food & Meals</option>
                                <option value="insurance">Insurance</option>
                                <option value="permits">Permits & Licenses</option>
                                <option value="truck_payment">Truck Payment/Lease</option>
                                <option value="supplies">Supplies</option>
                                <option value="drivers_pay">Drivers Pay</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vendor/Location:</label>
                            <input type="text" id="expenseVendor" placeholder="Pilot Flying J" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes (Optional):</label>
                        <input type="text" id="expenseNotes" placeholder="Additional details...">
                    </div>
                    <button type="submit" class="btn-generate">Add Expense</button>
                </div>
            </form>

            <div class="expense-history-section">
                <div class="history-header-section">
                    <input type="text" id="searchExpenses" placeholder="Search expenses..." class="search-input">
                </div>
                <div id="expensesList" class="history-list">
                    <div class="no-history">No expenses yet. Add your first expense!</div>
                </div>
            </div>
        </div>

        <!-- Driver Tools View -->
        <div id="toolsView" class="view">
            <div class="tools-container">
                <h2>üõ†Ô∏è Driver Tools</h2>

                <!-- Tool Navigation Tabs -->
                <div class="tools-tabs">
                    <button type="button" class="tool-tab active" data-tool="fuelLog">‚õΩ Fuel Log</button>
                    <button type="button" class="tool-tab" data-tool="rateCheck">üíµ Rate Check</button>
                    <button type="button" class="tool-tab" data-tool="perDiem">üçΩÔ∏è Per Diem</button>
                    <button type="button" class="tool-tab" data-tool="cpmCalc">üìä Cost/Mile</button>
                    <button type="button" class="tool-tab" data-tool="reminders">üîî Reminders</button>
                </div>

                <!-- Fuel Log Tool -->
                <div id="fuelLogTool" class="tool-panel active">
                    <form id="fuelLogForm" class="tool-form">
                        <div class="section">
                            <h3>‚õΩ Fuel Log Entry</h3>
                            <p class="section-description">Track your fuel purchases with automatic location detection.
                            </p>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Truck:</label>
                                    <select id="fuelTruck" title="Select truck">
                                        <option value="">All Trucks / No Selection</option>
                                    </select>
                                </div>
                                <div class="form-group truck-manage-btn-container">
                                    <button type="button" class="btn-secondary btn-small manage-trucks-global"
                                        onclick="openTruckModal()">‚öôÔ∏è Manage</button>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date:</label>
                                    <input type="date" id="fuelDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Odometer:</label>
                                    <input type="number" id="fuelOdometer" placeholder="123456" step="1">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Gallons:</label>
                                    <input type="number" id="fuelGallons" placeholder="150.5" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Price per Gallon ($):</label>
                                    <input type="number" id="fuelPricePerGallon" placeholder="3.45" step="0.001"
                                        required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Total Cost ($):</label>
                                <input type="number" id="fuelTotalCost" placeholder="Calculated automatically"
                                    step="0.01" readonly>
                            </div>

                            <div class="form-group location-group">
                                <label>Location:</label>
                                <div class="location-input-wrapper">
                                    <input type="text" id="fuelLocation" placeholder="City, State" required>
                                    <button type="button" id="autoLocationBtn" class="btn-location"
                                        title="Get current location">
                                        üìç Auto
                                    </button>
                                </div>
                                <div id="locationStatus" class="location-status hidden"></div>
                            </div>

                            <div class="form-group">
                                <label>Station Name (Optional):</label>
                                <input type="text" id="fuelStation" placeholder="Pilot, Love's, TA, etc.">
                            </div>

                            <button type="submit" class="btn-generate">Add Fuel Entry</button>
                        </div>
                    </form>

                    <div class="fuel-history-section">
                        <h3>Recent Fuel Entries</h3>
                        <div class="fuel-stats">
                            <div class="fuel-stat">
                                <span class="stat-label">Avg MPG (last 10):</span>
                                <span class="stat-value" id="avgMpg">--</span>
                            </div>
                            <div class="fuel-stat">
                                <span class="stat-label">Total Gallons (MTD):</span>
                                <span class="stat-value" id="mtdGallons">--</span>
                            </div>
                        </div>
                        <div id="fuelLogList" class="history-list">
                            <div class="no-history">No fuel entries yet.</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Rate Check Tool -->
                <div id="rateCheckTool" class="tool-panel">
                    <div class="section">
                        <h3>üíµ Is This Load Worth It?</h3>
                        <p class="section-description">Quickly check if a load meets your minimum rate requirements.</p>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Load Pay ($):</label>
                                <input type="number" id="rateCheckPay" placeholder="2500" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Total Miles:</label>
                                <input type="number" id="rateCheckMiles" placeholder="1000" step="1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Your Minimum CPM ($):</label>
                            <input type="number" id="rateCheckMinCpm" placeholder="2.50" step="0.01" value="2.50">
                            <small class="form-hint">This is saved for future checks</small>
                        </div>

                        <button type="button" id="checkRateBtn" class="btn-generate">Check Rate</button>

                        <div id="rateResult" class="rate-result hidden">
                            <div class="rate-calculation">
                                <div class="rate-line">
                                    <span>Rate per Mile:</span>
                                    <span id="calculatedRpm" class="rate-value">$0.00</span>
                                </div>
                                <div class="rate-line">
                                    <span>Your Minimum:</span>
                                    <span id="minRpmDisplay" class="rate-value">$0.00</span>
                                </div>
                                <div class="rate-line">
                                    <span>Difference:</span>
                                    <span id="rpmDifference" class="rate-value">$0.00</span>
                                </div>
                            </div>
                            <div id="rateVerdict" class="rate-verdict">
                                <!-- Verdict displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Per Diem Tracker Tool -->
                <div id="perDiemTool" class="tool-panel">
                    <div class="section">
                        <h3>üçΩÔ∏è Per Diem Tracker</h3>
                        <p class="section-description">Track your days on the road for per diem deductions. IRS rate:
                            $69/day (2024).</p>

                        <div class="per-diem-settings">
                            <div class="form-group">
                                <label>Per Diem Rate ($/day):</label>
                                <input type="number" id="perDiemRate" placeholder="69.00" step="0.01" value="69.00">
                                <small class="form-hint">IRS standard rate for transportation industry</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Trip Start Date:</label>
                                <input type="date" id="perDiemStart">
                            </div>
                            <div class="form-group">
                                <label>Trip End Date:</label>
                                <input type="date" id="perDiemEnd">
                            </div>
                        </div>

                        <div class="form-row checkbox-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="partialStartDay"> Partial start day (50%)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="partialEndDay"> Partial end day (50%)
                            </label>
                        </div>

                        <button type="button" id="calcPerDiemBtn" class="btn-generate">Calculate Per Diem</button>
                        <button type="button" id="addPerDiemBtn" class="btn-secondary">Add to Log</button>

                        <div id="perDiemResult" class="per-diem-result hidden">
                            <div class="per-diem-calculation">
                                <div class="perdiem-line">
                                    <span>Full Days:</span>
                                    <span id="fullDaysCount">0</span>
                                </div>
                                <div class="perdiem-line">
                                    <span>Partial Days:</span>
                                    <span id="partialDaysCount">0</span>
                                </div>
                                <div class="perdiem-line total">
                                    <span>Total Per Diem:</span>
                                    <span id="perDiemTotal">$0.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="per-diem-summary">
                            <h4>Year-to-Date Summary</h4>
                            <div class="perdiem-ytd">
                                <div class="ytd-stat">
                                    <span class="stat-label">Days on Road:</span>
                                    <span class="stat-value" id="ytdDays">0</span>
                                </div>
                                <div class="ytd-stat">
                                    <span class="stat-label">Total Per Diem:</span>
                                    <span class="stat-value" id="ytdPerDiem">$0.00</span>
                                </div>
                            </div>
                        </div>

                        <div id="perDiemLog" class="per-diem-log">
                            <h4>Per Diem Log</h4>
                            <div id="perDiemList" class="history-list">
                                <div class="no-history">No per diem entries yet.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Per Mile Calculator Tool -->
                <div id="cpmCalcTool" class="tool-panel">
                    <div class="section">
                        <h3>üìä True Cost Per Mile</h3>
                        <p class="section-description">Calculate your actual operating cost per mile based on your
                            expenses.</p>

                        <div class="cpm-period-selector">
                            <label>Calculate for:</label>
                            <select id="cpmPeriod" title="Select period">
                                <option value="mtd">This Month</option>
                                <option value="ytd">Year to Date</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>

                        <div id="cpmCustomRange" class="form-row hidden">
                            <div class="form-group">
                                <label>Start Date:</label>
                                <input type="date" id="cpmStartDate">
                            </div>
                            <div class="form-group">
                                <label>End Date:</label>
                                <input type="date" id="cpmEndDate">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Total Miles Driven:</label>
                            <input type="number" id="cpmMilesDriven" placeholder="Enter total miles for period"
                                step="1">
                            <small class="form-hint">Or calculate from fuel log if odometer is tracked</small>
                        </div>

                        <button type="button" id="calcCpmBtn" class="btn-generate">Calculate Cost Per Mile</button>

                        <div id="cpmResult" class="cpm-result hidden">
                            <div class="cpm-breakdown">
                                <h4>Expense Breakdown</h4>
                                <div id="cpmExpenseBreakdown" class="cpm-expenses">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                            <div class="cpm-total">
                                <div class="cpm-line">
                                    <span>Total Expenses:</span>
                                    <span id="cpmTotalExpenses">$0.00</span>
                                </div>
                                <div class="cpm-line">
                                    <span>Total Miles:</span>
                                    <span id="cpmTotalMiles">0</span>
                                </div>
                                <div class="cpm-line highlight">
                                    <span>Cost Per Mile:</span>
                                    <span id="cpmFinalValue">$0.00</span>
                                </div>
                            </div>
                            <div class="cpm-insight">
                                <p id="cpmInsight"><!-- Insight text --></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Service Reminders Tool -->
                <div id="remindersTool" class="tool-panel">
                    <form id="reminderForm" class="tool-form">
                        <div class="section">
                            <h3>üîî Service Reminders</h3>
                            <p class="section-description">Never miss an oil change, inspection, or registration
                                renewal.</p>

                            <div class="form-group">
                                <label>Reminder Type:</label>
                                <select id="reminderType" title="Select reminder type" required>
                                    <option value="">Select Type...</option>
                                    <option value="oil_change">Oil Change</option>
                                    <option value="dot_inspection">DOT Inspection</option>
                                    <option value="annual_inspection">Annual Inspection</option>
                                    <option value="registration">Registration Renewal</option>
                                    <option value="ifta">IFTA Filing</option>
                                    <option value="insurance">Insurance Renewal</option>
                                    <option value="permit">Permit Renewal</option>
                                    <option value="tires">Tire Replacement</option>
                                    <option value="brakes">Brake Service</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div id="customReminderName" class="form-group hidden">
                                <label>Custom Reminder Name:</label>
                                <input type="text" id="reminderCustomName" placeholder="e.g., DEF Fluid">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Due Date:</label>
                                    <input type="date" id="reminderDueDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Due at Miles (Optional):</label>
                                    <input type="number" id="reminderDueMiles" placeholder="500000" step="1">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Notes (Optional):</label>
                                <input type="text" id="reminderNotes" placeholder="Any additional details...">
                            </div>

                            <button type="submit" class="btn-generate">Add Reminder</button>
                        </div>
                    </form>

                    <div class="reminders-list-section">
                        <h3>Upcoming Reminders</h3>
                        <div id="remindersList" class="reminders-list">
                            <div class="no-history">No reminders set. Add your first reminder!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView" class="view">
            <div class="dashboard-header">
                <h2>Financial Dashboard</h2>
                <div class="dashboard-controls">
                    <div class="period-selector">
                        <label>Period:</label>
                        <select id="dashboardPeriod" title="Select period for dashboard">
                            <option value="ytd">Year to Date</option>
                            <option value="weekly">This Week</option>
                            <option value="pay-period">Pay Period</option>
                        </select>
                    </div>
                    <div class="year-selector">
                        <label>Year:</label>
                        <select id="dashboardYear" title="Select year for dashboard">
                            <!-- Populated by JavaScript -->
                        </select>
                    </div>
                    <div class="export-buttons">
                        <button type="button" id="exportExpenseReport" class="btn-export">Export Expense Report</button>
                        <button type="button" id="exportProfitLoss" class="btn-export">Export P&L Statement</button>
                    </div>
                </div>
            </div>

            <div class="dashboard-cards">
                <div class="dashboard-card income-card">
                    <div class="card-icon">üìä</div>
                    <div class="card-content">
                        <div class="card-label">Total Income (YTD)</div>
                        <div class="card-value" id="ytdIncome">$0.00</div>
                    </div>
                </div>
                <div class="dashboard-card expense-card">
                    <div class="card-icon">üí∞</div>
                    <div class="card-content">
                        <div class="card-label">Total Expenses (YTD)</div>
                        <div class="card-value" id="ytdExpenses">$0.00</div>
                    </div>
                </div>
                <div class="dashboard-card profit-card">
                    <div class="card-icon">üìà</div>
                    <div class="card-content">
                        <div class="card-label">Net Profit (YTD)</div>
                        <div class="card-value" id="ytdProfit">$0.00</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-breakdown">
                <div class="section">
                    <h3>Expense Breakdown</h3>
                    <div id="expenseBreakdown" class="breakdown-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                <div class="section">
                    <h3>Monthly Summary</h3>
                    <div id="monthlySummary" class="monthly-summary">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Truck Management Modal (Global) -->
    <div id="truckModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üöõ Manage Trucks</h3>
                <button type="button" class="modal-close" onclick="closeTruckModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="add-truck-form">
                    <h4>Add New Truck</h4>
                    <div class="form-row">
                        <input type="text" id="newTruckName" placeholder="Truck name (e.g., Truck 1, Blue Pete)">
                        <input type="text" id="newTruckUnit" placeholder="Unit # (optional)">
                    </div>
                    <button type="button" id="addTruckBtn" class="btn-generate" onclick="addTruck()">‚ûï Add
                        Truck</button>
                </div>
                <div class="truck-list-section">
                    <h4>Your Trucks</h4>
                    <div id="truckList" class="truck-list">
                        <div class="no-trucks">No trucks added yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Photo Modal -->
    <div id="receiptModal" class="receipt-modal">
        <button class="receipt-modal-close" onclick="closeReceiptModal()">‚úï</button>
        <img id="receiptModalImage" src="" alt="Receipt Full View">
    </div>

    <!-- Tip Jar Footer -->
    <div class="tip-jar-section">
        <button type="button" class="tip-jar-toggle" id="tipJarToggle"
            onclick="document.getElementById('tipJarContent').classList.toggle('hidden')">
            <span>‚òï</span> Support This App
        </button>
        <div class="tip-jar-content hidden" id="tipJarContent">
            <div class="tip-jar-message">
                <h3>üöõ Keep TruckInvoice Free!</h3>
                <p>Hey fellow driver! This app is built by an owner-operator just like you. I created it because I was
                    tired of complicated, expensive apps that don't understand our needs.</p>
                <p><strong>TruckInvoice is 100% free</strong> - no subscriptions, no ads, no BS. But keeping it running
                    and adding new features takes time and money (servers, development tools, coffee ‚òï).</p>
                <p>If this app saves you time or helps you stay organized on the road, consider buying me a coffee.
                    Every tip helps me keep improving the app for all of us!</p>
                <p class="tip-thanks">üôè Thanks for your support - safe travels out there!</p>
            </div>
            <div class="tip-jar-buttons">
                <a href="https://paypal.me/JosephRogers655443" target="_blank" rel="noopener"
                    class="tip-btn paypal-btn">
                    üí≥ Tip via PayPal
                </a>
            </div>
            <p class="tip-note">üí° Even $3-5 helps cover a month of server costs!</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script src="firebase-config.js"></script>
    <!-- Global navigation script (non-module) must load FIRST -->
    <script src="nav.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module" src="expenses.js"></script>
    <script type="module" src="dashboard.js"></script>
</body>

</html>